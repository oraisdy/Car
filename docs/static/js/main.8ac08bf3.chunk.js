(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,a){},16:function(e,t,a){},17:function(e,t,a){"use strict";a.r(t);var o=a(0),r=a.n(o),n=a(7),i=a.n(n),s=(a(15),a(1)),c=a(2),l=a(4),p=a(3),m=a(5),f=(a(16),90),h=Math.min(window.innerHeight,640),d=h-f,u=3,v=3,S=1e3,k=500,g=3.5,y=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={upKeyDown:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown.bind(this),!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){var t=this,a=this.props,o=a.heroPos,r=a.heroState;switch(e.preventDefault(),e.keyCode){case 37:1===r&&this.props.onPosChange(Math.max(0,o-1));break;case 39:1===r&&this.props.onPosChange(Math.min(o+1,1));break;case 38:this.props.onStateChange(1),this.state.upKeyDown?this.props.onSpeedUp():(this.setState({upKeyDown:!0}),setTimeout(function(){t.setState({upKeyDown:!1})},k));break;case 40:this.props.onStateChange(0)}}},{key:"render",value:function(){var e=this.props,t=e.heroPos,a=e.isHit,o=e.gameState,n=e.lifeInformer;return r.a.createElement("div",{className:["hero",0===t?"left":"right",a?"twinkling":"",1===o?"":"hidden"].join(" ")},r.a.createElement("div",{className:"life life".concat(n)}))}}]),t}(r.a.Component),b=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).mainLoop=function(e){if(requestAnimationFrame(a.mainLoop),!(e-a.lastTime<1e3/60)){if(1===a.props.heroState&&a.roadRef.current){var t=a.props.heroSpeed+a.props.extraSpeed;a.top=a.top+t,a.roadRef.current.style.top=a.top+"px",a.top>=0&&(a.updateCols(),a.props.increaseKilometer(),a.roadRef.current.style.top="-128px",a.top=-128)}a.lastTime=e}},a.updateCols=function(){var e=a.state,t=e.roadCol1,o=e.roadCol5;t.unshift(r.a.createElement("div",{key:t.pop().key,className:I()})),o.unshift(r.a.createElement("div",{key:o.pop().key,className:I()})),a.setState({roadCol1:t,roadCol5:o})};var o=new Array(10).fill(0).map(function(e,t){return r.a.createElement("div",{key:t,className:"road-block road-block-road1"})}),n=new Array(10).fill(0).map(function(e,t){return r.a.createElement("div",{key:t,className:"road-block road-block-road3"})}),i=new Array(10).fill(0).map(function(e,t){return r.a.createElement("div",{key:t,className:I()})}),c=new Array(10).fill(0).map(function(e,t){return r.a.createElement("div",{key:t,className:I()})});return a.state={roadCol1:i,roadCol2:o,roadCol4:n,roadCol5:c},a.top=0,a.lastTime=0,a.roadRef=r.a.createRef(),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){requestAnimationFrame(this.mainLoop)}},{key:"render",value:function(){var e=this.state,t=e.roadCol5,a=e.roadCol1,o=e.roadCol2,n=e.roadCol4;return r.a.createElement("div",{className:"road",ref:this.roadRef},r.a.createElement("div",{className:"road-col road-col-1"},a),r.a.createElement("div",{className:"road-col road-col-2"},o),r.a.createElement("div",{className:"road-col road-col-3"}),r.a.createElement("div",{className:"road-col road-col-4"},n),r.a.createElement("div",{className:"road-col road-col-5"},t))}}]),t}(r.a.Component),I=function(){var e=Math.random();return e<.3?"road-block road-block-tree1":e<.6?"road-block road-block-tree2":e<.7?"road-block road-block-tent":"road-block"},L=a(8),O=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).trafficLoop=function(){var e=Math.round(6e3*Math.random())+1e3;a.timeout=setTimeout(function(){a.createTraffic(),a.trafficLoop()},e)},a.createTraffic=function(){var e=a.props.gameState,t=a.state,o=t.currentCarId,r=t.participants;1===e&&r.length<u&&a.setState({participants:[].concat(Object(L.a)(r),[o+1]),currentCarId:o+1})},a.onFinish=function(e){a.setState({participants:a.state.participants.filter(function(t){return t!==e})})},a.onLose=function(e){a.onFinish(e),a.props.onLose("crash")},a.state={participants:[],currentCarId:0},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.trafficLoop()}},{key:"render",value:function(){var e=this,t=this.state.participants.map(function(t){return r.a.createElement(C,{carId:t,key:t,onFinish:e.onFinish,onLose:e.onLose,extraSpeed:e.props.extraSpeed,heroSpeed:e.props.heroSpeed,heroPos:e.props.heroPos,heroState:e.props.heroState})});return r.a.createElement("div",null,t)}}]),t}(r.a.Component),C=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).mainLoop=function(){var e=a.top;if(e>=h)a.props.onFinish(a.props.carId);else if(a.state.carPos===a.props.heroPos&&e>=d-f)a.props.onLose(a.props.carId);else{var t=e+a.state.carSpeed+a.props.extraSpeed;1===a.props.heroState&&(t+=a.props.heroSpeed),a.top=t,a.carRef.current.style.top=t+"px",a.animationId=requestAnimationFrame(a.mainLoop)}},a.state={carSpeed:2*Math.random()+2,carPos:Math.floor(2*Math.random()),isHit:!1},a.carRef=r.a.createRef(),a.animationId=null,a.top=-f,a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.animationId=requestAnimationFrame(this.mainLoop)}},{key:"componentWillUnmount",value:function(){this.animationId&&cancelAnimationFrame(this.animationId)}},{key:"render",value:function(){var e=this.state.carPos;return r.a.createElement("div",{className:"car ".concat(["left","right"][e]),ref:this.carRef})}}]),t}(r.a.Component),E=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).mainLoop=function(e){a.animationId=requestAnimationFrame(a.mainLoop);var t=a.props,o=t.heroState,r=t.gameState,n=a.state,i=n.trafficType,s=n.trafficLightId;1===o&&s>0&&a.trafficLightRef.current&&(a.top+=a.props.heroSpeed+a.props.extraSpeed,a.trafficLightRef.current.style.top=a.top+"px",a.top>=h?a.setState({inScreen:!1}):1===r&&0!==i&&a.top>=d&&a.props.onLose("traffic light"))},a.trafficLoop=function(){var e=Math.round(6e3*Math.random())+3e3;a.timeout=setTimeout(function(){a.createTraffic(),a.trafficLoop()},e)},a.createTraffic=function(){var e=a.props,t=e.heroState,o=e.gameState,r=a.state.inScreen;1!==o||1!==t||r||(a.setState({trafficLightId:a.state.trafficLightId+1,inScreen:!0}),a.top=-60)},a.state={trafficType:0,trafficLightId:0,inScreen:!1},a.trafficLightRef=r.a.createRef(),a.animationId=null,a.intervalId=null,a.top=-60,a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.trafficLoop(),this.animationId=requestAnimationFrame(this.mainLoop),this.intervalId=setInterval(function(){e.setState({trafficType:(e.state.trafficType+1)%3})},2e3)}},{key:"componentWillUnmount",value:function(){this.intervalId&&clearInterval(this.intervalId),this.animationId&&cancelAnimationFrame(this.animationId)}},{key:"render",value:function(){var e=this.state,t=e.trafficLightId,a=e.trafficType,o=this.props.heroState;return r.a.createElement("div",{className:["trafficlight",t>0?"":"hidden",1===o?"running":"paused",["green","red","yellow"][a]].join(" "),key:t,ref:this.trafficLightRef})}}]),t}(r.a.Component),j=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).increaseKilometer=function(){1===a.state.gameState&&1===a.state.heroState&&a.setState({kilometers:a.state.kilometers+.35})},a.throttledChangeInformer=function(){var e=!0;return function(t){e&&(e=!1,a.setState({isHit:!0}),a.state.lifeInformer<=1&&a.gameOver(),a.setState({lifeInformer:a.state.lifeInformer-1}),setTimeout(function(){e=!0,a.setState({isHit:!1})},S))}},a.throttledChangeSpeed=function(){var e=!0;return function(t){e&&(e=!1,a.setState({heroSpeed:a.state.heroSpeed+3}),setTimeout(function(){e=!0,a.setState({heroSpeed:a.state.heroSpeed-3})},k))}},a.gameOver=function(){a.setState({gameState:0})},a.startGame=function(){a.setState({gameState:1})},a.restartGame=function(){a.setState({gameState:1,heroPos:0,heroState:1,lifeInformer:v,isHit:!1,kilometers:0})},a.state={gameState:-1,heroPos:0,heroState:1,lifeInformer:v,isHit:!1,kilometers:0,heroSpeed:g},a.loseLife=a.throttledChangeInformer(),a.speedUp=a.throttledChangeSpeed(),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.gameState,o=t.heroState,n=t.heroPos,i=t.lifeInformer,s=t.isHit,c=t.kilometers,l=t.heroSpeed,p=Math.floor(c/10);return r.a.createElement("div",null,r.a.createElement("div",{className:"container"},r.a.createElement(b,{heroState:o,extraSpeed:p,heroSpeed:l,increaseKilometer:this.increaseKilometer}),1===a&&r.a.createElement("div",{className:"informer"},Math.floor(c)),r.a.createElement(y,{isHit:s,gameState:a,heroState:o,heroPos:n,lifeInformer:i,onStateChange:function(t){e.setState({heroState:t})},onPosChange:function(t){e.setState({heroPos:t})},onSpeedUp:this.speedUp}),r.a.createElement(E,{gameState:a,heroState:o,extraSpeed:p,heroSpeed:l,onLose:this.loseLife,onGameOver:this.gameOver}),r.a.createElement(O,{gameState:a,heroPos:n,heroState:o,extraSpeed:p,heroSpeed:l,onLose:this.loseLife,onGameOver:this.gameOver}),-1===a&&r.a.createElement("div",{className:"startgame",onClick:this.startGame}),0===a&&r.a.createElement("div",{className:"gameover"},r.a.createElement("ul",null,r.a.createElement("li",null,"\u4f60\u7684\u6210\u7ee9\uff1a",Math.floor(c)," km"),r.a.createElement("li",{onClick:this.restartGame},r.a.createElement("span",{className:"restartgame"}))))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},9:function(e,t,a){e.exports=a(17)}},[[9,1,2]]]);
//# sourceMappingURL=main.8ac08bf3.chunk.js.map