(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,a){e.exports=a(20)},16:function(e,t,a){},17:function(e,t,a){},20:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(9),i=a.n(o),c=(a(16),a(1)),s=a(2),l=a(4),f=a(3),m=a(5),u=(a(17),function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown.bind(this),!1)}},{key:"handleKeyDown",value:function(e){var t=this.props,a=t.heroPos,n=t.heroState;switch(e.preventDefault(),e.keyCode){case 37:1===n&&this.props.onPosChange(Math.max(0,a-1));break;case 39:1===n&&this.props.onPosChange(Math.min(a+1,1));break;case 38:this.props.onStateChange(1);break;case 40:this.props.onStateChange(0)}}},{key:"render",value:function(){var e=this.props,t=e.heroPos,a=e.isHit,n=e.gameState,o=e.lifeInformer;return r.a.createElement("div",null,1===n&&r.a.createElement("div",{className:"hero ".concat(0===t?"left":"right"," ").concat(a?"twinkling":"")},r.a.createElement("div",{className:"life life".concat(o)})))}}]),t}(r.a.Component)),h=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.heroState;return r.a.createElement("div",{className:"road ".concat(1===e?"running":"paused")},r.a.createElement("div",{className:"road-col road-col-1 ".concat(1===e?"running":"paused")}),r.a.createElement("div",{className:"road-col road-col-2 ".concat(1===e?"running":"paused")}),r.a.createElement("div",{className:"road-col road-col-3 ".concat(1===e?"running":"paused")}),r.a.createElement("div",{className:"road-col road-col-4 ".concat(1===e?"running":"paused")}),r.a.createElement("div",{className:"road-col road-col-5 ".concat(1===e?"running":"paused")}))}}]),t}(r.a.Component),p=a(10),d=90,v=Math.min(window.innerHeight,650),g=v-d,S=3,b=3,O=1e3,I=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).trafficLoop=function(){var e=Math.round(6e3*Math.random())+1e3;a.timeout=setTimeout(function(){a.createTraffic(),a.trafficLoop()},e)},a.createTraffic=function(){var e=a.props.gameState,t=a.state,n=t.currentCarId,r=t.participants;1===e&&r.length<S&&a.setState({participants:[].concat(Object(p.a)(r),[n+1]),currentCarId:n+1})},a.onFinish=function(e){a.setState({participants:a.state.participants.filter(function(t){return t!==e})})},a.onLose=function(e){a.onFinish(e),a.props.onLose()},a.state={participants:[],currentCarId:0},a.lastTime=0,a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.trafficLoop()}},{key:"render",value:function(){var e=this,t=this.state.participants.map(function(t){return r.a.createElement(k,{carId:t,key:t,onFinish:e.onFinish,onLose:e.onLose,heroPos:e.props.heroPos,heroState:e.props.heroState})});return r.a.createElement("div",null,t)}}]),t}(r.a.Component),k=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).mainLoop=function(){var e=a.carRef.current.getBoundingClientRect().top;if(e>=v)a.props.onFinish(a.props.carId);else if(a.state.carPos===a.props.heroPos&&e>=g-d)a.props.onLose(a.props.carId);else{var t=e+a.state.carSpeed;1===a.props.heroState&&(t+=3),a.carRef.current.style.top=t+"px",a.animationId=requestAnimationFrame(a.mainLoop)}},a.state={carSpeed:3*Math.random()+3,carPos:Math.floor(2*Math.random()),isHit:!1},a.carRef=r.a.createRef(),a.animationId=null,a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.animationId=requestAnimationFrame(this.mainLoop)}},{key:"componentWillUnmount",value:function(){this.animationId&&cancelAnimationFrame(this.animationId)}},{key:"render",value:function(){var e=this.state.carPos;return r.a.createElement("div",{className:"car ".concat(["left","right"][e]),ref:this.carRef})}}]),t}(r.a.Component),j=function(e){if(window.getComputedStyle){var t=getComputedStyle(e),a=t.transform||t.webkitTransform||t.mozTransform,n=a.match(/^matrix3d\((.+)\)$/);return n?parseFloat(n[1].split(", ")[13]):(n=a.match(/^matrix\((.+)\)$/))?parseFloat(n[1].split(", ")[5]):0}},y=a(7),L=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).mainLoop=function(){var e=a.props,t=e.heroState,n=e.gameState,r=a.state.trafficType;1===n&&1===t&&0!==r&&a.trafficLightRef.current&&j(a.trafficLightRef.current)>=g&&(a.props.onLose(),a.setState({isHit:!0}))},a.trafficLoop=function(){var e=Math.round(6e3*Math.random())+3e3;a.timeout=setTimeout(function(){a.createTraffic(),a.trafficLoop()},e)},a.createTraffic=function(){var e=a.props,t=e.heroState;1===e.gameState&&1===t&&a.setState({trafficLightId:a.state.trafficLightId+1,isHit:!1})},a.state={trafficType:0,trafficLightId:0,isHit:!1},a.trafficLightRef=r.a.createRef(),a.intervalId=null,a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.trafficLoop(),this.intervalId=Object(y.setInterval)(function(){e.mainLoop()},10),Object(y.setInterval)(function(){e.setState({trafficType:(e.state.trafficType+1)%3})},2e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.intervalId)}},{key:"render",value:function(){var e=this.state,t=e.trafficLightId,a=e.trafficType,n=e.isHit,o=this.props.heroState;return r.a.createElement("div",null,t>0&&r.a.createElement("div",{className:["trafficlight",1===o?"running":"paused",["green","red","yellow"][a],n?"twinkling":""].join(" "),key:t,ref:this.trafficLightRef}))}}]),t}(r.a.Component),E=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).increseKilometers=function(){a.intervalId=setInterval(function(){1===a.state.gameState&&1===a.state.heroState&&a.setState({kilometers:a.state.kilometers+1})},2e3)},a.throttledChangeInformer=function(){var e=!0;return function(){e&&(e=!1,a.setState({isHit:!0}),a.state.lifeInformer<=0&&a.gameOver(),a.setState({lifeInformer:a.state.lifeInformer-1}),setTimeout(function(){e=!0,a.setState({isHit:!1})},O))}},a.gameOver=function(){a.setState({gameState:0})},a.startGame=function(){a.setState({gameState:1})},a.restartGame=function(){a.setState({gameState:1,heroPos:0,heroState:1,lifeInformer:b,isHit:!1,kilometers:0})},a.state={gameState:-1,heroPos:0,heroState:1,lifeInformer:b,isHit:!1,kilometers:0},a.loseLife=a.throttledChangeInformer(),a.intervalId=null,a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.increseKilometers()}},{key:"componentWillUnmount",value:function(){this.intervalId&&clearInterval(this.intervalId)}},{key:"render",value:function(){var e=this,t=this.state,a=t.gameState,n=t.heroState,o=t.heroPos,i=t.lifeInformer,c=t.isHit,s=t.kilometers;return r.a.createElement("div",null,r.a.createElement("div",{className:"container"},r.a.createElement(h,{heroState:n}),1===a&&r.a.createElement("div",{className:"informer"},s),r.a.createElement(u,{isHit:c,gameState:a,heroState:n,heroPos:o,lifeInformer:i,onStateChange:function(t){e.setState({heroState:t})},onPosChange:function(t){e.setState({heroPos:t})}}),r.a.createElement(L,{gameState:a,heroState:n,onLose:this.loseLife,onGameOver:this.gameOver}),r.a.createElement(I,{gameState:a,heroPos:o,heroState:n,onLose:this.loseLife,onGameOver:this.gameOver}),-1===a&&r.a.createElement("div",{className:"startgame",onClick:this.startGame}),0===a&&r.a.createElement("div",{className:"gameover"},r.a.createElement("ul",null,r.a.createElement("li",null,"\u4f60\u7684\u6210\u7ee9\uff1a",s," km"),r.a.createElement("li",{onClick:this.restartGame},r.a.createElement("span",{className:"restartgame"}))))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[11,1,2]]]);
//# sourceMappingURL=main.df46b755.chunk.js.map