(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,a){},16:function(e,t,a){},17:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(7),i=a.n(o),c=(a(15),a(1)),s=a(2),l=a(4),f=a(3),m=a(5),u=(a(16),function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown.bind(this),!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){var t=this.props,a=t.heroPos,n=t.heroState;switch(e.preventDefault(),e.keyCode){case 37:1===n&&this.props.onPosChange(Math.max(0,a-1));break;case 39:1===n&&this.props.onPosChange(Math.min(a+1,1));break;case 38:this.props.onStateChange(1);break;case 40:this.props.onStateChange(0)}}},{key:"render",value:function(){var e=this.props,t=e.heroPos,a=e.isHit,n=e.gameState,o=e.lifeInformer;return r.a.createElement("div",{className:["hero",0===t?"left":"right",a?"twinkling":"",1===n?"":"hidden"].join(" ")},r.a.createElement("div",{className:"life life".concat(o)}))}}]),t}(r.a.Component)),d=90,h=Math.min(window.innerHeight,640),p=h-d,v=3,S=3,g=1e3,k=3,y=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).mainLoop=function(e){if(requestAnimationFrame(a.mainLoop),1===a.props.heroState&&a.roadRef.current){var t=a.roadRef.current.getBoundingClientRect().top,n=k+a.props.extraSpeed;a.roadRef.current.style.top=t+n+"px",t>=0&&(a.updateCols(),a.roadRef.current.style.top="-128px")}},a.updateCols=function(){var e=a.state,t=e.roadCol1,n=e.roadCol5;t.unshift(r.a.createElement("div",{key:t.pop().key,className:b()})),n.unshift(r.a.createElement("div",{key:n.pop().key,className:b()})),a.setState({roadCol1:t,roadCol5:n})};var n=new Array(10).fill(0).map(function(e,t){return r.a.createElement("div",{key:t,className:"road-block road-block-road1"})}),o=new Array(10).fill(0).map(function(e,t){return r.a.createElement("div",{key:t,className:"road-block road-block-road3"})}),i=new Array(10).fill(0).map(function(e,t){return r.a.createElement("div",{key:t,className:b()})}),s=new Array(10).fill(0).map(function(e,t){return r.a.createElement("div",{key:t,className:b()})});return a.state={roadCol1:i,roadCol2:n,roadCol4:o,roadCol5:s},a.roadRef=r.a.createRef(),a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){requestAnimationFrame(this.mainLoop)}},{key:"render",value:function(){var e=this.state,t=e.roadCol5,a=e.roadCol1,n=e.roadCol2,o=e.roadCol4;return r.a.createElement("div",{className:"road",ref:this.roadRef},r.a.createElement("div",{className:"road-col road-col-1"},a),r.a.createElement("div",{className:"road-col road-col-2"},n),r.a.createElement("div",{className:"road-col road-col-3"}),r.a.createElement("div",{className:"road-col road-col-4"},o),r.a.createElement("div",{className:"road-col road-col-5"},t))}}]),t}(r.a.Component),b=function(){var e=Math.random();return e<.3?"road-block road-block-tree1":e<.6?"road-block road-block-tree2":e<.7?"road-block road-block-tent":"road-block"},L=a(8),C=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).trafficLoop=function(){var e=Math.round(6e3*Math.random())+1e3;a.timeout=setTimeout(function(){a.createTraffic(),a.trafficLoop()},e)},a.createTraffic=function(){var e=a.props.gameState,t=a.state,n=t.currentCarId,r=t.participants;1===e&&r.length<v&&a.setState({participants:[].concat(Object(L.a)(r),[n+1]),currentCarId:n+1})},a.onFinish=function(e){a.setState({participants:a.state.participants.filter(function(t){return t!==e})})},a.onLose=function(e){a.onFinish(e),a.props.onLose("crash")},a.state={participants:[],currentCarId:0},a.lastTime=0,a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.trafficLoop()}},{key:"render",value:function(){var e=this,t=this.state.participants.map(function(t){return r.a.createElement(I,{carId:t,key:t,onFinish:e.onFinish,onLose:e.onLose,extraSpeed:e.props.extraSpeed,heroPos:e.props.heroPos,heroState:e.props.heroState})});return r.a.createElement("div",null,t)}}]),t}(r.a.Component),I=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).mainLoop=function(){var e=a.carRef.current.getBoundingClientRect().top;if(e>=h)a.props.onFinish(a.props.carId);else if(a.state.carPos===a.props.heroPos&&e>=p-d)a.props.onLose(a.props.carId);else{var t=e+a.state.carSpeed+a.props.extraSpeed;1===a.props.heroState&&(t+=k),a.carRef.current.style.top=t+"px",a.animationId=requestAnimationFrame(a.mainLoop)}},a.state={carSpeed:2*Math.random()+1,carPos:Math.floor(2*Math.random()),isHit:!1},a.carRef=r.a.createRef(),a.animationId=null,a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.animationId=requestAnimationFrame(this.mainLoop)}},{key:"componentWillUnmount",value:function(){this.animationId&&cancelAnimationFrame(this.animationId)}},{key:"render",value:function(){var e=this.state.carPos;return r.a.createElement("div",{className:"car ".concat(["left","right"][e]),ref:this.carRef})}}]),t}(r.a.Component),O=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).mainLoop=function(e){requestAnimationFrame(a.mainLoop);var t=a.props,n=t.heroState,r=t.gameState,o=a.state,i=o.trafficType,c=o.trafficLightId;if(1===r&&1===n&&c>0&&a.trafficLightRef.current){var s=a.trafficLightRef.current.getBoundingClientRect().top,l=k+a.props.extraSpeed;a.trafficLightRef.current.style.top=s+l+"px",s>=h?a.setState({inScreen:!1}):0!==i&&s>=p&&a.props.onLose("traffic light")}},a.trafficLoop=function(){var e=Math.round(6e3*Math.random())+3e3;a.timeout=setTimeout(function(){a.createTraffic(),a.trafficLoop()},e)},a.createTraffic=function(){var e=a.props,t=e.heroState,n=e.gameState,r=a.state.inScreen;1!==n||1!==t||r||a.setState({trafficLightId:a.state.trafficLightId+1,inScreen:!0})},a.state={trafficType:0,trafficLightId:0,inScreen:!1},a.trafficLightRef=r.a.createRef(),a.intervalId=null,a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.trafficLoop(),requestAnimationFrame(this.mainLoop),setInterval(function(){e.setState({trafficType:(e.state.trafficType+1)%3})},2e3)}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.state,t=e.trafficLightId,a=e.trafficType,n=this.props.heroState;return r.a.createElement("div",{className:["trafficlight",t>0?"":"hidden",1===n?"running":"paused",["green","red","yellow"][a]].join(" "),key:t,ref:this.trafficLightRef})}}]),t}(r.a.Component),E=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(f.a)(t).call(this,e))).increseKilometers=function(){a.intervalId=setInterval(function(){1===a.state.gameState&&1===a.state.heroState&&a.setState({kilometers:a.state.kilometers+1})},2e3)},a.throttledChangeInformer=function(){var e=!0;return function(t){e&&(e=!1,console.log("IS HIT",t),a.setState({isHit:!0}),a.state.lifeInformer<=0&&a.gameOver(),a.setState({lifeInformer:a.state.lifeInformer-1}),setTimeout(function(){e=!0,a.setState({isHit:!1})},g))}},a.gameOver=function(){a.setState({gameState:0})},a.startGame=function(){a.setState({gameState:1})},a.restartGame=function(){a.setState({gameState:1,heroPos:0,heroState:1,lifeInformer:S,isHit:!1,kilometers:0})},a.state={gameState:-1,heroPos:0,heroState:1,lifeInformer:S,isHit:!1,kilometers:0},a.loseLife=a.throttledChangeInformer(),a.intervalId=null,a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.increseKilometers()}},{key:"componentWillUnmount",value:function(){this.intervalId&&clearInterval(this.intervalId)}},{key:"render",value:function(){var e=this,t=this.state,a=t.gameState,n=t.heroState,o=t.heroPos,i=t.lifeInformer,c=t.isHit,s=t.kilometers,l=Math.floor(s/10);return r.a.createElement("div",null,r.a.createElement("div",{className:"container"},r.a.createElement(y,{heroState:n,extraSpeed:l}),1===a&&r.a.createElement("div",{className:"informer"},s),r.a.createElement(u,{isHit:c,gameState:a,heroState:n,heroPos:o,lifeInformer:i,onStateChange:function(t){e.setState({heroState:t})},onPosChange:function(t){e.setState({heroPos:t})}}),r.a.createElement(O,{gameState:a,heroState:n,extraSpeed:l,onLose:this.loseLife,onGameOver:this.gameOver}),r.a.createElement(C,{gameState:a,heroPos:o,heroState:n,extraSpeed:l,onLose:this.loseLife,onGameOver:this.gameOver}),-1===a&&r.a.createElement("div",{className:"startgame",onClick:this.startGame}),0===a&&r.a.createElement("div",{className:"gameover"},r.a.createElement("ul",null,r.a.createElement("li",null,"\u4f60\u7684\u6210\u7ee9\uff1a",s," km"),r.a.createElement("li",{onClick:this.restartGame},r.a.createElement("span",{className:"restartgame"}))))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},9:function(e,t,a){e.exports=a(17)}},[[9,1,2]]]);
//# sourceMappingURL=main.a24cfe54.chunk.js.map